import subprocess as sp, argparse, shlex, pandas as pd, pysam, os
from helper_modules.file_manager import FileManager as FM


parser = argparse.ArgumentParser(usage = 'Testing gatk GenomicsDBImport parallelization optimization')
parser.add_argument('Genome', type = str, help = 'Version of the genome to align to')
args = parser.parse_args()

# Create FileManager object to keep track of filenames
fm_obj = FM(args.Genome)

# Make sure genome version is a valid option
if args.Genome not in fm_obj.returnGenomeVersions():
	raise argparse.ArgumentTypeError('Genome version does not exist. Options are: ' + ','.join(fm_obj.returnGenomeVersions()))

error_files = ['SAMEA2661362', 'SAMEA4032060', 'SAMEA6147767', 'SAMEA4033269', 'SAMEA2661268', 'SAMEA2661349', 'SAMEA1904329', 'SAMEA4033260', 'SAMEA4033321', 'SAMEA2661447', 'SAMEA1877429', 'SAMEA2661307', 'SAMEA2661242', 'SAMEA4032041', 'SAMEA2661417', 'MZ_2_f', 'SAMEA4032124', 'SAMN08051115', 'SAMEA4032132', 'SAMEA4032103', 'SAMN08051120', 'SAMEA2661235', 'SAMEA1877436', 'SAMEA4032104', 'SAMEA2661378', 'SAMEA2661336', 'SAMEA2661247', 'SAMEA2661333', 'SAMEA2661427', 'SAMEA2661273', 'SAMEA2661231', 'SAMEA6147774', 'SAMEA2661351', 'SAMEA2661422', 'SAMN06685757', 'SAMEA2661217', 'SAMEA2661308', 'SAMEA2661230', 'SAMEA4033265', 'SAMEA4033320', 'SAMEA2661354', 'SAMEA2661241', 'SAMEA4033288', 'SAMEA4032067', 'SAMEA2661419', 'SAMEA4033328', 'SAMEA4033335', 'SAMEA4032050', 'SAMEA2661279', 'SAMEA4033303', 'SAMEA2661325', 'SAMEA4033318', 'SAMEA4032108', 'SAMEA4033341', 'SAMEA2661436', 'SAMEA2661448', 'SAMEA2661412', 'SAMEA2661331', 'SAMEA2661386', 'SAMEA3388867', 'SAMEA1877417', 'SAMEA4033274', 'SAMEA4033314', 'SAMEA2661432', 'SAMEA2661352', 'SAMEA3388854', 'SAMEA4032129', 'SAMEA2661361', 'SAMEA2661229', 'SAMEA4032109', 'SAMEA4032052', 'SAMEA2661269', 'SAMEA2661250', 'SAMEA2661260', 'SAMEA4033298', 'SAMEA2661434', 'SAMEA4032036', 'SAMEA2661249', 'SAMEA2661433', 'SAMEA4032047', 'SAMEA2661405', 'SAMEA4033330', 'SAMEA4032043', 'SAMEA2661365', 'SAMEA2661266', 'SAMEA4033300', 'SAMEA4033332', 'SAMEA1920094', 'SAMEA1904833', 'SAMEA4032110', 'SAMEA2661408', 'SAMEA4033257', 'SAMEA2661428', 'SAMEA3388878', 'SAMEA4032044', 'SAMEA4032039', 'SAMEA2661348', 'SAMEA4032040', 'SAMEA2661287', 'SAMEA4033252', 'SAMEA4032105', 'SAMN06685751', 'SAMEA2661304', 'SAMEA2661227', 'SAMEA2661391', 'SAMEA3388855', 'SAMEA4033295', 'SAMEA1877507', 'SAMEA4032090', 'SAMEA2661435', 'SAMEA1877503', 'SAMEA4032131', 'SAMEA4033248', 'SAMEA3388870', 'SAMEA2661357', 'SAMEA4033313', 'SAMEA2661420', 'SAMEA3388859', 'SAMEA4032058', 'SAMEA2661309', 'SAMEA1920098', 'SAMEA4032045', 'SAMEA1904323', 'SAMEA2661345', 'SAMEA2661359', 'SAMEA2661383', 'SAMEA4033311', 'SAMEA2661425', 'SAMEA2661423', 'SAMEA1877414', 'SAMEA2661421', 'SAMN06685761', 'SAMEA4032064', 'SAMEA2661350', 'SAMEA2661364', 'SAMEA1904327', 'SAMEA2661439', 'SAMEA1877472', 'SAMEA4032096', 'SAMEA1877469', 'SAMEA1877494', 'SAMEA4032092', 'SAMEA2661294', 'SAMEA4032054', 'SAMEA4032053', 'SAMEA2661443', 'SAMEA2661216', 'SAMEA4032066', 'SAMEA2661232', 'SAMEA1877476', 'SAMEA1904326', 'SAMEA4032126', 'SAMEA4033251', 'SAMEA2661372', 'SAMEA2661369', 'SAMEA4032037', 'SAMEA4032056', 'SAMEA4032057', 'SAMEA1920091', 'SAMEA2661363', 'SAMEA2661342', 'SAMEA4033294', 'SAMEA4033285', 'SAMEA4033268', 'SAMEA2661245', 'SAMEA2661402', 'SAMN06685752', 'SAMEA2661338', 'SAMN06685766', 'SAMEA4033302', 'YH_1_m', 'SAMEA1904330', 'SAMEA4032046', 'SAMEA2661379', 'SAMEA4033256', 'SAMEA2661450', 'SAMEA4032099', 'SAMEA4033333', 'SAMEA2661291', 'SAMEA2661299', 'SAMEA2661358', 'SAMEA1877409', 'SAMEA4033254', 'SAMEA2661222', 'SAMEA2661392', 'SAMEA4033249', 'SAMEA3388865', 'SAMEA2661418', 'SAMEA2661396', 'SAMEA4032114', 'SAMEA2661237', 'SAMEA2661388', 'SAMEA6147766', 'SAMEA2661415', 'SAMEA2661320', 'SAMEA4032128', 'SAMEA4033283', 'SAMEA4033319', 'SAMEA2661343', 'SAMEA2661341', 'SAMEA4033312', 'SAMEA2661376', 'MC_2_f', 'SAMEA2661302', 'SAMEA2661398', 'SAMEA2661323', 'SAMEA6147768', 'SAMEA2661382', 'SAMEA4032136', 'SAMEA2661444', 'MZ_1_m', 'SAMEA2661451', 'SAMEA4033275', 'SAMEA4033258', 'SAMEA4033279', 'SAMN06685754', 'SAMN08051114', 'SAMEA2661282', 'SAMEA2661259', 'SAMN08051113', 'SAMEA2661401', 'SAMEA6147772', 'SAMEA4032068', 'SAMEA4033266', 'SAMEA4033337', 'SAMEA2661367', 'SAMEA3388862', 'SAMEA1877400', 'SAMEA2661430', 'SAMEA4033301', 'SAMEA3480882', 'SAMEA4032101', 'SAMEA2661238', 'SAMEA2661292', 'SAMEA2661324', 'SAMEA2661270', 'SAMEA6147773', 'SAMEA2661252', 'SAMEA4033262', 'SAMEA2661390', 'SAMEA2661272', 'SAMEA4033273', 'SAMEA2661413', 'SAMEA2661246', 'SAMEA4033247', 'SAMEA2661327', 'SAMEA4033323', 'SAMEA2661355', 'SAMEA4033271', 'SAMEA4032107', 'SAMEA4032127', 'SAMEA2661264', 'SAMEA2661407', 'SAMEA2661347', 'SAMN06685767', 'SAMEA2661414', 'SAMEA2661411', 'SAMEA2661298', 'SAMEA4033317', 'SAMEA2661395', 'SAMEA4032100', 'SAMEA1877402', 'SAMEA4033292', 'SAMEA3388868', 'SAMEA2661221', 'SAMN06685764', 'SAMEA2661262', 'SAMEA2661310', 'SAMEA1904322', 'SAMEA2661288', 'SAMEA4032055', 'SAMEA2661281', 'SAMEA4032051', 'SAMEA2661332', 'SAMEA4032134', 'SAMEA3388863', 'SAMEA2661389', 'SAMEA3388873', 'SAMEA4032033', 'SAMEA4033306', 'SAMEA2661424', 'SAMEA4033299', 'SAMEA2661410', 'SAMEA4033280', 'SAMEA2661337', 'SAMEA6147765', 'SAMEA3388872', 'SAMEA4033276', 'SAMEA4033325', 'SAMN06685750', 'SAMEA1877442', 'SAMEA2661225', 'SAMEA2661385', 'SAMEA4032115', 'SAMEA1920093', 'SAMN06685755', 'SAMEA2661431', 'SAMN06685749', 'SAMEA2661375', 'SAMEA4033293', 'SAMEA4032059', 'SAMEA4033272', 'SAMEA4032065', 'SAMEA4032097', 'SAMEA2661300', 'SAMEA1877451', 'SAMN06685763', 'SAMEA2661397', 'SAMEA2661356', 'SAMEA4033277', 'SAMEA2661330', 'SAMEA3388857', 'SAMEA4032094', 'SAMEA2661409', 'SAMEA2661253', 'SAMEA4033296', 'SAMEA2661303', 'SAMEA2661380', 'SAMEA2661296', 'SAMEA2661251', 'SAMEA4033307', 'SAMEA2661224', 'SAMEA3388853', 'SAMEA4032091', 'SAMEA4032038', 'SAMEA4032042', 'SAMEA4033264', 'SAMEA1877459', 'SAMEA3388860', 'SAMEA2661437', 'SAMEA4051560', 'SAMN06701600', 'SAMEA2661316', 'SAMEA2661285', 'SAMEA2661293', 'SAMEA1877447', 'SAMEA2661239', 'SAMEA4033270', 'SAMEA2661234', 'SAMN08051112', 'SAMN06685758', 'SAMEA2661319', 'SAMN06685756', 'SAMEA4032125', 'SAMEA2661258', 'SAMEA2661306', 'SAMEA4033322', 'SAMEA2661374', 'SAMEA2661223', 'CV_1_m', 'SAMEA4033253', 'SAMEA1920095', 'SAMEA2661353', 'SAMEA1904324', 'SAMEA4033284', 'SAMEA2661377', 'SAMEA2661438', 'SAMEA2661404', 'SAMEA4032138', 'SAMEA6147771', 'SAMEA4033304', 'SAMEA2661400', 'SAMEA4033305', 'SAMEA6147770', 'SAMEA4032034', 'SAMEA2661267', 'SAMEA2661254', 'SAMEA1877480', 'SAMEA2661399', 'SAMEA4033267', 'SAMEA4033331', 'SAMEA3388876', 'SAMEA4033297', 'SAMEA4032123', 'SAMEA2661295', 'SAMEA1877464', 'SAMEA2661370', 'SAMEA2661297', 'SAMEA2661219', 'SAMEA4032048', 'SAMEA4032137', 'SAMEA1920096', 'SAMEA3388856', 'SAMEA1920090', 'SAMEA2661244', 'SAMEA4032095', 'SAMEA3388858', 'SAMEA2661366', 'SAMEA2661261', 'SAMEA2661226', 'SAMEA2661442', 'SAMEA3388871', 'SAMEA4033278', 'SAMEA2661290', 'SAMEA2661441', 'SAMEA4033263', 'SAMEA4033316', 'SAMEA4033286', 'SAMEA4033339', 'SAMEA4033310', 'SAMEA6147764', 'SAMN08051119', 'SAMEA6147769', 'SAMEA1877421', 'SAMN06685753', 'SAMEA2661301', 'SAMEA4032111', 'SAMEA4033315', 'SAMEA2661240', 'SAMEA2661344', 'SAMEA2661426', 'SAMEA1877440', 'SAMEA2661445', 'SAMEA1877484', 'SAMN06685759', 'SAMEA2661346', 'SAMEA2661371', 'SAMEA4033334', 'SAMEA2661220', 'SAMEA2661373', 'SAMEA2661321', 'SAMEA3388877', 'SAMEA4033329', 'SAMEA2661394', 'SAMEA2661265', 'SAMEA2661368', 'SAMEA4032049', 'SAMEA1920092', 'SAMEA3388875', 'SAMN06685712', 'SAMEA2661384', 'SAMEA2661335', 'SAMEA4033289', 'SAMEA2661275', 'SAMEA1877489', 'SAMEA4033326', 'SAMEA4032130', 'SAMEA2661440', 'SAMEA2661228', 'SAMEA4032113', 'SAMEA4033291', 'SAMEA4033324', 'SAMEA4032093', 'SAMEA4033282', 'SAMEA1904832', 'SAMEA2661429', 'SAMEA2661243', 'SAMEA2661263', 'SAMEA1904837', 'SAMEA2661449', 'SAMEA2661313', 'SAMEA2661339', 'SAMEA4033340', 'SAMEA4033290', 'SAMEA4033327', 'SAMN06685765', 'SAMEA2661276', 'SAMEA1877497', 'SAMEA4033309', 'SAMEA1877499', 'SAMEA1877411', 'SAMEA2661360', 'SAMEA2661277', 'SAMEA2661393', 'SAMN06685762', 'SAMEA2661248', 'SAMEA4033255', 'SAMEA2661446', 'SAMEA1877404', 'SAMEA4033250', 'SAMEA2661280', 'SAMEA2661381', 'SAMEA1877511', 'SAMEA1904328', 'SAMEA2661318', 'SAMEA2661283', 'SAMEA2661236', 'SAMEA2661256', 'SAMEA4051559', 'SAMEA4032035', 'SAMEA4032098', 'SAMEA4033261', 'SAMEA1877407', 'CV_2_f', 'SAMEA2661340', 'SAMEA4033259', 'SAMEA4032089', 'SAMEA4033287', 'SAMEA4032088', 'SAMEA4032106', 'SAMN06685760', 'SAMEA1877433', 'SAMEA3388864', 'SAMEA3388874', 'SAMEA2661387', 'SAMEA4032061', 'SAMEA2661278', 'SAMEA4032070', 'SAMEA2661322', 'SAMEA4033281', 'SAMEA4033308', 'SAMEA2661403', 'SAMEA1920097', 'SAMEA2661334', 'SAMEA1877455', 'SAMN08051121', 'SAMEA2661289', 'SAMEA2661326', 'SAMEA4032112', 'SAMEA4033336', 'SAMEA2661328', 'SAMEA2661416', 'MC_1_m', 'SAMEA4032102', 'SAMEA2661218', 'SAMEA2661233', 'SAMEA1904331', 'SAMEA1877425', 'SAMEA4032069', 'SAMEA4033338', 'SAMEA2661311', 'SAMEA2661257']
for file in error_files:
	sp.run(shlex.split(f"rclone copy ptm_dropbox:BioSci-McGrath/Apps/CichlidSequencingData/Bamfiles/Mzebra_UMD2a/{file}/{file}.all.bam /Data/mcgrath-lab/Data/CichlidSequencingData/Bamfiles/Mzebra_UMD2a/{file}/ -P"))

# for contig in contigs:
#     p = sp.Popen(shlex.split(f"gatk GenomicsDBImport --genomicsdb-workspace-path {'/Data/mcgrath-lab/Data/CichlidSequencingData/Databases/' + contig + '_database'} --intervals {contig} --sample-name-map sample_map_utaka.txt --reader-threads 4 --overwrite-existing-genomicsdb-workspace"))
#     processes.append(p)

#     if len(processes) == 4:
#         for p in processes:
#             p.communicate()
#         processes = []

# fm_obj.downloadData(fm_obj.localAlignmentFile)
#### Download the reference genome files and build the proper directry structure for them locally.
# fm_obj.downloadData(fm_obj.localGenomeDir)

# a_dt = pd.read_csv(fm_obj.localAlignmentFile)
# a_dt = a_dt[a_dt.GenomeVersion == args.Genome]
# sampleIDs = set(a_dt.SampleID)
